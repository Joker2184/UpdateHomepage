name: Sync to Alist via WebDAV

on:
  schedule:
    - cron: "0 1 * * *"
  workflow_dispatch:

jobs:
  sync_to_alist:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ” Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Install rclone
        run: |
          sudo apt update
          sudo apt install -y rclone

      - name: ğŸ” Debug config (safe)
        run: echo "URL: https://${{ secrets.WEBDAV_HOST }}:${{ secrets.WEBDAV_PORT }}/dav"

      - name: âš™ï¸ Configure rclone
        run: rclone config create alist_webdav webdav url "https://${{ secrets.WEBDAV_HOST }}:${{ secrets.WEBDAV_PORT }}/dav" vendor "other" user "${{ secrets.ALIST_USERNAME }}" pass "${{ secrets.ALIST_PASSWORD }}"

      - name: ğŸ“‹ Test connection
        run: rclone lsd alist_webdav: --verbose

      - name: ğŸ“¤ Sync files
        run: rclone sync ./ alist_webdav:/ --checksum --verbose --retries 3

      - name: ğŸ§¹ Clean up
        if: always()
        run: rm -rf ï½/.config/rclone
