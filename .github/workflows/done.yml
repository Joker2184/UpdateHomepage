name: Sync to Alist via WebDAV

on:
  schedule:
    - cron: "0 1 * * *"
  workflow_dispatch:

jobs:
  sync_to_alist:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ” Checkout repository
        uses: actions/checkout@v4

      - name: ðŸš€ Install rclone
        run: sudo apt install -y rclone

      - name: âš™ï¸ Configure rclone
        env:
          WEBDAV_URL: "https://${{ secrets.WEBDAV_HOST }}:${{ secrets.WEBDAV_PORT }}/dav"
        run: |
          mkdir -p ~/.config/rclone
          echo "[alist_webdav]" > ~/.config/rclone/rclone.conf
          echo "type = webdav" >> ~/.config/rclone/rclone.conf
          echo "url = $WEBDAV_URL" >> ~/.config/rclone/rclone.conf
          echo "vendor = other" >> ~/.config/rclone/rclone.conf
          echo "user = ${{ secrets.ALIST_USERNAME }}" >> ~/.config/rclone/rclone.conf
          echo "pass = ${{ secrets.ALIST_PASSWORD }}" >> ~/.config/rclone/rclone.conf

      - name: ðŸ“¤ Sync to AList
        run: rclone sync ./ alist_webdav:/ --checksum --ignore-times --retries 3 -v

      - name: ðŸ§¹ Clean up
        if: always()
        run: rm -rf ~/.config/rclone
