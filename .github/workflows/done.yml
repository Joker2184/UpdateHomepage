name: Sync to Alist via WebDAV

on:
  schedule:
    - cron: "0 1 * * *"
  workflow_dispatch:

jobs:
  sync_to_alist:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ” Checkout repository
        uses: actions/checkout@v4

      - name: ðŸš€ Install rclone
        run: sudo apt install -y rclone

      - name: âš™ï¸ Configure rclone
        run: |
          # åˆ›å»ºé…ç½®ç›®å½•
          mkdir -p ~/.config/rclone
          
          # åˆ›å»ºé…ç½®æ–‡ä»¶
          cat > ~/.config/rclone/rclone.conf << EOF
          [alist_webdav]
          type = webdav
          url = ${{ secrets.WEBDAV_HP }}
          vendor = other
          user = ${{ secrets.ALIST_USERNAME }}
          pass = ${{ secrets.ALIST_PASSWORD }}
          EOF
          
          # éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼
          echo "é…ç½®æ–‡ä»¶å†…å®¹é¢„è§ˆï¼ˆéšè—å¯†ç ï¼‰ï¼š"
          cat ~/.config/rclone/rclone.conf | grep -v "pass ="

      - name: ðŸ“¤ Sync to AList
        run: rclone sync ./ alist_webdav:/ --checksum --ignore-times --retries 3 -v

      - name: ðŸ§¹ Clean up
        if: always()
        run: rm -rf ~/.config/rclone
