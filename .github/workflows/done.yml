name: Sync to Alist via WebDAV

on:
  # è¿™é‡Œè¯·è‡ªè¡Œé…ç½®
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  sync_to_alist:
    runs-on: ubuntu-latest
    steps:
      # ç­¾å‡ºä»“åº“
      - name: Checkout repository
        uses: actions/checkout@v2

      # å¦‚æœæœ‰æ„å»ºå™¨ï¼Œåœ¨è¿™é‡Œå¤„ç†å¥½

      # å®‰è£… rclone
      - name: ğŸš€ Install rclone
        run: |
          curl https://rclone.org/install.sh | sudo bash

      # é…ç½® rclone for WebDAV (Alist)
      - name: âš™ï¸ Configure rclone for WebDAV (Alist)
        run: |
          rclone config create alist_webdav webdav \
            url https://${{ secrets.WEBDAV_HOST }}:${{ secrets.WEBDAV_PORT }}/dav \
            user ${{ secrets.ALIST_USERNAME }} \
            pass ${{ secrets.ALIST_PASSWORD }}

      # æ›¿æ¢æ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•
      # å¦‚æœè¿˜æœ‰åˆ«çš„æ–‡ä»¶ï¼Œè‡ªå·±é…ç½®
      # rclone copy [æ–‡ä»¶åå¸¦åç¼€ï¼Œç›¸å¯¹äºä»“åº“æ ¹ç›®å½•] alist_webdav:/ --checksum --size-only --retries 3
      - name: ğŸ“¤ Copy build files to Alist WebDAV
        run: |
          rclone copy Custom.xaml alist_webdav:/ --checksum --size-only --retries 3
          rclone copy Custom.xaml.ini alist_webdav:/ --checksum --size-only --retries 3

      # æ¸…ç† rclone é…ç½®
      - name: ğŸ§¹ Clean up rclone config
        if: always()
        run: rm -rf ~/.config/rclone
