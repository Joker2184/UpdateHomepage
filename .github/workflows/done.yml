name: Sync to Alist via WebDAV

on:
  schedule:
    - cron: 0 1 * * *
  workflow_dispatch:

jobs:
  sync_to_alist:
    runs-on: ubuntu-latest
    steps:
      # ç­¾å‡ºä»“åº“
      - name: Checkout repository
        uses: actions/checkout@v2

      # å®‰è£… rclone
      - name: ğŸš€ Install rclone
        run: |
          curl https://rclone.org/install.sh | sudo bash

      # é…ç½® rclone for WebDAV (Alist)
      - name: âš™ï¸ Configure rclone for WebDAV (Alist)
        run: |
          rclone config create alist_webdav webdav \
            url https://${{ secrets.WEBDAV_HOST }}:${{ secrets.WEBDAV_PORT }}/dav \
            user ${{ secrets.ALIST_USERNAME }} \
            pass ${{ secrets.ALIST_PASSWORD }}

      # æ›¿æ¢æ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•
      - name: ğŸ“¤ Copy build files to Alist WebDAV
        run: |
          rclone sync ./output/ alist_webdav:/ --checksum --ignore-times --retries 3

      # æ¸…ç† rclone é…ç½®
      - name: ğŸ§¹ Clean up rclone config
        if: always()
        run: rm -rf ~/.config/rclone
