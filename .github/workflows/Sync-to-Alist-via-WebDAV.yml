name: Sync to Alist via WebDAV

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  sync_to_alist:
    runs-on: ubuntu-latest
    steps:
      # Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Install rclone
      - name: Install rclone
        run: |
          curl https://rclone.org/install.sh | sudo bash

      # Configure rclone for WebDAV
      - name: Configure rclone for WebDAV
        run: |
          rclone config create alist_webdav webdav \
            url http://${{ secrets.WEBDAV_HOST }}:${{ secrets.WEBDAV_PORT }}/dav \
            user ${ { secrets.ALIST_USERNAME }} \
            pass ${ { secrets.ALIST_PASSWORD }}

      # Sync files to Alist WebDAV
      - name: Sync files to Alist
        run: |
          rclone copy ./your-local-folder alist_webdav:/  # Sync to the root of your Alist WebDAV

      # Optionally, clean up rclone configuration (for security)
      - name: Clean up rclone config
        run: rm -rf ~/.config/rclone
