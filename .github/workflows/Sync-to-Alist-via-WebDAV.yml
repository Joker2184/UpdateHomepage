name: Sync to Alist via WebDAV

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  sync_to_alist:
    runs-on: ubuntu-latest
    steps:
      # Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Install davfs2 (WebDAV client)
      - name: Install davfs2
        run: |
          sudo apt-get update
          sudo apt-get install -y davfs2

      # Create directory and mount WebDAV with sudo
      - name: Mount WebDAV
        run: |
          sudo mkdir -p /home/runner/webdav  # Using /home/runner instead of ~
          sudo mount -t davfs http://${{ secrets.WEBDAV_HOST }}:${{ secrets.WEBDAV_PORT }}/dav /home/runner/webdav
        env:
          DAVFS_USERNAME: ${{ secrets.ALIST_USERNAME }}
          DAVFS_PASSWORD: ${{ secrets.ALIST_PASSWORD }}
          WEBDAV_HOST: ${{ secrets.WEBDAV_HOST }}  # WebDAV Host (domain)
          WEBDAV_PORT: ${{ secrets.WEBDAV_PORT }}  # WebDAV Port (port)

      # Sync files to Alist root directory (sub-account root)
      - name: Sync files to Alist root
        run: |
          sudo cp -r ./your-local-folder/* /home/runner/webdav/

   
